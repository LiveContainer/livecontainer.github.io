"use strict";(self.webpackChunklivecontainer_docs=self.webpackChunklivecontainer_docs||[]).push([[439],{557:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"development/architecture","title":"System Architecture","description":"Project structure","source":"@site/docs/development/architecture.md","sourceDirName":"development","slug":"/development/architecture","permalink":"/zh-CN/docs/development/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/khanhduytran0/LiveContainer/tree/main/docs/docs/development/architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"System Architecture","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Building from Source","permalink":"/zh-CN/docs/development/building"},"next":{"title":"Common Issues","permalink":"/zh-CN/docs/faq/common-issues"}}');var l=i(4848),s=i(8453);const a={title:"System Architecture",sidebar_position:2},r="LiveContainer Architecture Overview",o={},c=[{value:"Project structure",id:"project-structure",level:2},{value:"Main executable",id:"main-executable",level:3},{value:"LiveContainerSwiftUI",id:"livecontainerswiftui",level:3},{value:"TweakLoader",id:"tweakloader",level:3},{value:"AltStoreTweak",id:"altstoretweak",level:3},{value:"ZSign",id:"zsign",level:3},{value:"How does it work?",id:"how-does-it-work",level:2},{value:"Patching guest executable",id:"patching-guest-executable",level:3},{value:"Patching <code>@executable_path</code>",id:"patching-executable_path",level:3},{value:"Patching <code>NSBundle.mainBundle</code>",id:"patching-nsbundlemainbundle",level:3},{value:"Bypassing Library Validation",id:"bypassing-library-validation",level:3},{value:"dlopening the executable",id:"dlopening-the-executable",level:3},{value:"Multi-Account support &amp; Keychain Semi-Separation",id:"multi-account-support--keychain-semi-separation",level:3},{value:"Limitations",id:"limitations",level:2}];function d(e){const n={a:"a",code:"code",del:"del",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"livecontainer-architecture-overview",children:"LiveContainer Architecture Overview"})}),"\n",(0,l.jsx)(n.h2,{id:"project-structure",children:"Project structure"}),"\n",(0,l.jsx)(n.h3,{id:"main-executable",children:"Main executable"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Core of LiveContainer"}),"\n",(0,l.jsx)(n.li,{children:"Contains the logic of setting up guest environment and loading guest app."}),"\n",(0,l.jsx)(n.li,{children:"If no app is selected, it loads LiveContainerSwiftUI."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"livecontainerswiftui",children:"LiveContainerSwiftUI"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SwiftUI rewrite of LiveContainerUI (by @hugeBlack)"}),"\n",(0,l.jsxs)(n.li,{children:["Lanaguage file ",(0,l.jsx)(n.code,{children:"Localizable.xcstrings"})," is in here for multilingual support"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"tweakloader",children:"TweakLoader"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"A simple tweak injector, which loads CydiaSubstrate and load tweaks."}),"\n",(0,l.jsx)(n.li,{children:"Injected to every app you install in LiveContainer."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"altstoretweak",children:"AltStoreTweak"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The tweak that got injected into SideStore/AltStore to retrieve certificate from it everytime it launches."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"zsign",children:"ZSign"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The app signer shipped with LiveContainer."}),"\n",(0,l.jsxs)(n.li,{children:["Originally made by ",(0,l.jsx)(n.a,{href:"https://github.com/zhlynn/zsign",children:"zhlynn"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["LiveContainer uses ",(0,l.jsx)(n.a,{href:"https://github.com/khcrysalis/Feather",children:"Feather's"})," version of ZSign modified by khcrysalis."]}),"\n",(0,l.jsx)(n.li,{children:"Changes are made to meet LiveContainer's need."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"how-does-it-work",children:"How does it work?"}),"\n",(0,l.jsx)(n.h3,{id:"patching-guest-executable",children:"Patching guest executable"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Patch ",(0,l.jsx)(n.code,{children:"__PAGEZERO"})," segment:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Change ",(0,l.jsx)(n.code,{children:"vmaddr"})," to ",(0,l.jsx)(n.code,{children:"0xFFFFC000"})," (",(0,l.jsx)(n.code,{children:"0x100000000 - 0x4000"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:["Change ",(0,l.jsx)(n.code,{children:"vmsize"})," to ",(0,l.jsx)(n.code,{children:"0x4000"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Change ",(0,l.jsx)(n.code,{children:"MH_EXECUTE"})," to ",(0,l.jsx)(n.code,{children:"MH_DYLIB"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Inject a load command to load ",(0,l.jsx)(n.code,{children:"TweakLoader.dylib"})]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"patching-executable_path",children:["Patching ",(0,l.jsx)(n.code,{children:"@executable_path"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Call ",(0,l.jsx)(n.code,{children:"_NSGetExecutablePath"})," with an invalid buffer pointer input -> SIGSEGV"]}),"\n",(0,l.jsxs)(n.li,{children:["Do some ",(0,l.jsx)(n.a,{href:"https://github.com/khanhduytran0/LiveContainer/blob/5ef1e6a/main.m#L74-L115",children:"magic stuff"})," to overwrite the contents of executable_path."]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"patching-nsbundlemainbundle",children:["Patching ",(0,l.jsx)(n.code,{children:"NSBundle.mainBundle"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"This property is overwritten with the guest app's bundle."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"bypassing-library-validation",children:"Bypassing Library Validation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"JIT is optional to bypass codesigning. In JIT-less mode, all executables are signed so this does not apply."}),"\n",(0,l.jsxs)(n.li,{children:["Derived from ",(0,l.jsx)(n.a,{href:"https://blog.xpnsec.com/restoring-dyld-memory-loading",children:"Restoring Dyld Memory Loading"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"dlopening-the-executable",children:"dlopening the executable"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Call ",(0,l.jsx)(n.code,{children:"dlopen"})," with the guest app's executable"]}),"\n",(0,l.jsx)(n.li,{children:"TweakLoader loads all tweaks in the selected folder"}),"\n",(0,l.jsx)(n.li,{children:"Find the entry point"}),"\n",(0,l.jsx)(n.li,{children:"Jump to the entry point"}),"\n",(0,l.jsxs)(n.li,{children:["The guest app's entry point calls ",(0,l.jsx)(n.code,{children:"UIApplicationMain"})," and start up like any other iOS apps."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"multi-account-support--keychain-semi-separation",children:"Multi-Account support & Keychain Semi-Separation"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"./entitlements.xml",children:"128 keychain access groups"})," are created and LiveContainer allocates them randomly to each container of the same app. So you can create 128 container with different keychain access groups."]}),"\n",(0,l.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Entitlements from the guest app are not applied to the host app. This isn't a big deal since sideloaded apps requires only basic entitlements."}),"\n",(0,l.jsx)(n.li,{children:"App Permissions are globally applied."}),"\n",(0,l.jsx)(n.li,{children:"Guest app containers are not sandboxed. This means one guest app can access other guest apps' data."}),"\n",(0,l.jsx)(n.li,{children:"App extensions aren't supported. they cannot be registered because: LiveContainer is sandboxed, SpringBoard doesn't know what apps are installed in LiveContainer, and they take up App ID."}),"\n",(0,l.jsx)(n.li,{children:"Only one guest app can run at a time. This is much more like 3 apps limit where you have to disable an app to run another (switching between app in LiveContainer is instant)."}),"\n",(0,l.jsxs)(n.li,{children:["Remote push notification might not work. ",(0,l.jsx)(n.del,{children:"If you have a paid developer account then you don't even have to use LiveContainer"})]}),"\n",(0,l.jsx)(n.li,{children:"Querying custom URL schemes might not work(?)"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var t=i(6540);const l={},s=t.createContext(l);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);