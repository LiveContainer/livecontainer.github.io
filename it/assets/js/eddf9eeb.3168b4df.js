"use strict";(globalThis.webpackChunklivecontainer_docs=globalThis.webpackChunklivecontainer_docs||[]).push([[753],{3780(e,i,n){n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"development/architecture","title":"Architettura di Sistema","description":"LiveContainer \xe8 pi\xf9 di una shell app - \xe8 un piccolo runtime che ri-ospita app iOS arbitrarie dentro il suo sandbox, livella la tweak injection e offre il multitasking pi\xf9 l\'esecuzione JIT-Less. Questa pagina riassume come \xe8 organizzata la codebase moderna e come il launcher esegue i processi.","source":"@site/i18n/it/docusaurus-plugin-content-docs/current/development/architecture.md","sourceDirName":"development","slug":"/development/architecture","permalink":"/it/docs/development/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/LiveContainer/livecontainer.github.io/tree/main/docs/development/architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Architettura di Sistema","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Compilare da Sorgente","permalink":"/it/docs/development/building"},"next":{"title":"Problemi Comuni","permalink":"/it/docs/faq/common-issues"}}');var r=n(4848),a=n(8453);const t={title:"Architettura di Sistema",sidebar_position:2},s="Overview dell'architettura di LiveContainer",o={},c=[{value:"Struttura del Progetto",id:"struttura-del-progetto",level:2},{value:"Eseguibile principale (<code>LiveContainer</code>)",id:"eseguibile-principale-livecontainer",level:3},{value:"LiveContainerSwiftUI",id:"livecontainerswiftui",level:3},{value:"LiveProcess",id:"liveprocess",level:3},{value:"MultitaskSupport",id:"multitasksupport",level:3},{value:"SideStore helpers",id:"sidestore-helpers",level:3},{value:"TweakLoader",id:"tweakloader",level:3},{value:"ZSign",id:"zsign",level:3},{value:"Librerie di terze parti",id:"librerie-di-terze-parti",level:3},{value:"Come funziona",id:"come-funziona",level:2},{value:"Preparare l&#39;eseguibile guest",id:"preparare-leseguibile-guest",level:3},{value:"Patching <code>@executable_path</code>",id:"patching-executable_path",level:3},{value:"Patching <code>NSBundle.mainBundle</code>",id:"patching-nsbundlemainbundle",level:3},{value:"Bypassare Library Validation / Code Signing",id:"bypassare-library-validation--code-signing",level:3},{value:"Eseguire l&#39;app",id:"eseguire-lapp",level:3},{value:"Supporto al multi account e semi-separazione del keychain",id:"supporto-al-multi-account-e-semi-separazione-del-keychain",level:3},{value:"Limitazioni",id:"limitazioni",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"overview-dellarchitettura-di-livecontainer",children:"Overview dell'architettura di LiveContainer"})}),"\n",(0,r.jsx)(i.p,{children:"LiveContainer \xe8 pi\xf9 di una shell app - \xe8 un piccolo runtime che ri-ospita app iOS arbitrarie dentro il suo sandbox, livella la tweak injection e offre il multitasking pi\xf9 l'esecuzione JIT-Less. Questa pagina riassume come \xe8 organizzata la codebase moderna e come il launcher esegue i processi."}),"\n",(0,r.jsx)(i.h2,{id:"struttura-del-progetto",children:"Struttura del Progetto"}),"\n",(0,r.jsxs)(i.h3,{id:"eseguibile-principale-livecontainer",children:["Eseguibile principale (",(0,r.jsx)(i.code,{children:"LiveContainer"}),")"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Punto d'ingresso per l'intera piattaforma. Gestisce il bootstrapping, la gestione dei dati, la vita dei container ed esegue istanze di LiveProcess per i guest."}),"\n",(0,r.jsxs)(i.li,{children:["Quando non ci sono guest in esecuzione, presenta l'interfaccia SwiftUI (",(0,r.jsx)(i.code,{children:"LiveContainerSwiftUI"}),")."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"livecontainerswiftui",children:"LiveContainerSwiftUI"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Layer UI SwiftUI contribuito da ",(0,r.jsx)(i.a,{href:"https://github.com/hugeBlack",children:"@hugeBlack"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:["Ospita gli asset delle lingue (",(0,r.jsx)(i.code,{children:"Localizable.xcstrings"}),"). Unisciti al nostro ",(0,r.jsx)(i.a,{href:"https://crowdin.com/project/livecontainer",children:"progetto Crowdin"})," per aiutarci a tradurre le stringhe."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"liveprocess",children:"LiveProcess"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Eseguibile leggero che contiene il guest loader. Si avvia con gli stessi entitlements ma con un bundle id diverso per consentire il multitasking e la PID-based JIT."}),"\n",(0,r.jsx)(i.li,{children:"Responsabile del patching del guest binary, configurazione dyld, tweak injection e del trasferimento del controllo all'entry point dell'app."}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"multitasksupport",children:"MultitaskSupport"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Implementa il sistema delle floating window in app e l'integrazione nativa delle finestre di iPadOS."}),"\n",(0,r.jsx)(i.li,{children:"Comunica con il container principale per mantenere lo stato dell'app e la gestione dell'input sincronizzate tra diverse istanze di LiveProcess."}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"sidestore-helpers",children:"SideStore helpers"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Codice che integra le API del refresh/JIT di SideStore. Fornisce il refresh in background del certificato, l'aggiornamento del source e la gestione dell'URL scheme per le installazioni da SideStore."}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"tweakloader",children:"TweakLoader"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Substrate loader minimalista integrato in LiveContainer."}),"\n",(0,r.jsxs)(i.li,{children:["Iniettato in ogni guest tramite un nuovo comando; pu\xf2 essere cambiato sostituendo il symlink ",(0,r.jsx)(i.code,{children:"TweakLoader.dylib"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"zsign",children:"ZSign"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Signer integrato (forkato da ",(0,r.jsx)(i.a,{href:"https://github.com/zhlynn/zsign",children:"zhlynn/zsign"})," tramite ",(0,r.jsx)(i.a,{href:"https://github.com/khcrysalis/Feather",children:"Feather"}),")."]}),"\n",(0,r.jsx)(i.li,{children:"LiveContainer mantiene un branch personalizzato legato ai suoi requisiti di entitlements e multi-container."}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"librerie-di-terze-parti",children:"Librerie di terze parti"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"fishhook"}),", ",(0,r.jsx)(i.code,{children:"litehook"}),", e ",(0,r.jsx)(i.code,{children:"OpenSSL"})," sono presenti come git submodule. Permettono l'hooking e la crittografia a basso livello del loader e del signer."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"come-funziona",children:"Come funziona"}),"\n",(0,r.jsx)(i.h3,{id:"preparare-leseguibile-guest",children:"Preparare l'eseguibile guest"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Riscrivi il segmento ",(0,r.jsx)(i.code,{children:"__PAGEZERO"})," (",(0,r.jsx)(i.code,{children:"vmaddr = 0xFFFFC000"}),", ",(0,r.jsx)(i.code,{children:"vmsize = 0x4000"}),") cosicch\xe9 il binary possa essere mappato in LiveProcess."]}),"\n",(0,r.jsxs)(i.li,{children:["Cambia il Mach-O type da ",(0,r.jsx)(i.code,{children:"MH_EXECUTE"})," a ",(0,r.jsx)(i.code,{children:"MH_DYLIB"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:["Inietta un comando che carica ",(0,r.jsx)(i.code,{children:"TweakLoader.dylib"})," prima che ",(0,r.jsx)(i.code,{children:"UIApplicationMain"})," venga eseguito."]}),"\n"]}),"\n",(0,r.jsxs)(i.h3,{id:"patching-executable_path",children:["Patching ",(0,r.jsx)(i.code,{children:"@executable_path"})]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Le build recenti sfruttano ",(0,r.jsx)(i.code,{children:"dyld4::APIs::_NSGetExecutablePath"})," usando litehook/fishhook."]}),"\n",(0,r.jsxs)(i.li,{children:["L'hook chiama l'implementazione originale, rendendo scrivibile ",(0,r.jsx)(i.code,{children:"config.process.mainExecutablePath"})," e cambia il percorso per far s\xec che il guest risolva le suo stesse bundle resources."]}),"\n",(0,r.jsxs)(i.li,{children:["Il vecchio patching basato sulla SIGSEGV non \xe8 pi\xf9 utilizzato ma \xe8 ancora documentato nella ",(0,r.jsx)(i.a,{href:"https://github.com/LiveContainer/LiveContainer/blob/main/README.md",children:"repo principale"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(i.h3,{id:"patching-nsbundlemainbundle",children:["Patching ",(0,r.jsx)(i.code,{children:"NSBundle.mainBundle"})]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"NSBundle.mainBundle"})," \xe8 overridden cos\xec le richieste API ricevono il bundle guest anzich\xe9 quello di LiveContainer."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"bypassare-library-validation--code-signing",children:"Bypassare Library Validation / Code Signing"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Quando la JIT \xe8 disponibile, LiveContainer chiede all'enabler configurato di svegliare la signature check dell'eseguibile."}),"\n",(0,r.jsx)(i.li,{children:"Nella modalit\xe0 JIT-Less, ZSign ri-firma ogni guest coi tweak usando il certificato importato da AltStore/SideStore."}),"\n",(0,r.jsxs)(i.li,{children:["Il bypass \xe8 basato sul ",(0,r.jsx)(i.a,{href:"https://blog.xpnsec.com/restoring-dyld-memory-loading",children:"Restoring Dyld Memory Loading"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"eseguire-lapp",children:"Eseguire l'app"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["LiveProcess ",(0,r.jsx)(i.code,{children:"dlopen"})," \xe8 il binario guest patchato."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"TweakLoader"})," carica CydiaSubstrate e le cartelle tweak per guest."]}),"\n",(0,r.jsxs)(i.li,{children:["Il loader risolve l'entry point del programma e passa ad esso; poi il guest chiama ",(0,r.jsx)(i.code,{children:"UIApplicationMain"})," come sempre."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"supporto-al-multi-account-e-semi-separazione-del-keychain",children:"Supporto al multi account e semi-separazione del keychain"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Vengono definiti ",(0,r.jsx)(i.a,{href:"https://github.com/LiveContainer/LiveContainer/blob/main/entitlements.xml",children:"128 keychain access groups"}),". I container scelgono a caso i gruppi per ridurre le collisioni tra app, abilitando accessi isolati per container."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"limitazioni",children:"Limitazioni"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Gli entitlement del guest non sono copiati all'host. Valgono solo gli entitlement base garantiti a LiveContainer."}),"\n",(0,r.jsx)(i.li,{children:"I permessi delle app (fotocamera, foto, ecc.) sono globali per tutti i guest."}),"\n",(0,r.jsx)(i.li,{children:"I container condividono lo stesso sandbox, quindi un guest malevolo pu\xf2 leggere i file di un altro guest."}),"\n",(0,r.jsx)(i.li,{children:"Le app extension non possono essere registrate (la SpringBoard non le vede e gli App ID sono limitati)."}),"\n",(0,r.jsx)(i.li,{children:"In alcuni casi il multitasking blocca le tastiere hardware o l'input di iPhone Mirroring."}),"\n",(0,r.jsx)(i.li,{children:"Le notifiche push remote e gli URL scheme personalizzati spesso falliscono perch\xe9 LiveContainer non pu\xf2 registrarli con la SpringBoard."}),"\n"]})]})}function u(e={}){const{wrapper:i}={...(0,a.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,i,n){n.d(i,{R:()=>t,x:()=>s});var l=n(6540);const r={},a=l.createContext(r);function t(e){const i=l.useContext(a);return l.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(a.Provider,{value:i},e.children)}}}]);