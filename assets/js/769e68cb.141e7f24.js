"use strict";(globalThis.webpackChunklivecontainer_docs=globalThis.webpackChunklivecontainer_docs||[]).push([[439],{5111(e,i,n){n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"development/architecture","title":"System Architecture","description":"LiveContainer is more than a shell app\u2014it is a small runtime that re-hosts arbitrary iOS apps inside its own sandbox, layers tweak injection, and offers multitasking plus JIT-less execution. This page summarizes how the modern codebase is organized and how the launcher brings guest processes to life.","source":"@site/docs/development/architecture.md","sourceDirName":"development","slug":"/development/architecture","permalink":"/docs/development/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/LiveContainer/livecontainer.github.io/tree/main/docs/development/architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"System Architecture","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Building from Source","permalink":"/docs/development/building"},"next":{"title":"FAQ","permalink":"/docs/faq"}}');var s=n(4848),r=n(8453);const a={title:"System Architecture",sidebar_position:2},l="LiveContainer Architecture Overview",o={},c=[{value:"Project Structure",id:"project-structure",level:2},{value:"Main executable (<code>LiveContainer</code>)",id:"main-executable-livecontainer",level:3},{value:"LiveContainerSwiftUI",id:"livecontainerswiftui",level:3},{value:"LiveProcess",id:"liveprocess",level:3},{value:"MultitaskSupport",id:"multitasksupport",level:3},{value:"SideStore helpers",id:"sidestore-helpers",level:3},{value:"TweakLoader",id:"tweakloader",level:3},{value:"ZSign",id:"zsign",level:3},{value:"Third-party libraries",id:"third-party-libraries",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Preparing the guest executable",id:"preparing-the-guest-executable",level:3},{value:"Patching <code>@executable_path</code>",id:"patching-executable_path",level:3},{value:"Patching <code>NSBundle.mainBundle</code>",id:"patching-nsbundlemainbundle",level:3},{value:"Bypassing Library Validation / Code Signing",id:"bypassing-library-validation--code-signing",level:3},{value:"Launching the app",id:"launching-the-app",level:3},{value:"Multi-account support &amp; keychain semi-separation",id:"multi-account-support--keychain-semi-separation",level:3},{value:"Limitations",id:"limitations",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"livecontainer-architecture-overview",children:"LiveContainer Architecture Overview"})}),"\n",(0,s.jsx)(i.p,{children:"LiveContainer is more than a shell app\u2014it is a small runtime that re-hosts arbitrary iOS apps inside its own sandbox, layers tweak injection, and offers multitasking plus JIT-less execution. This page summarizes how the modern codebase is organized and how the launcher brings guest processes to life."}),"\n",(0,s.jsx)(i.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,s.jsxs)(i.h3,{id:"main-executable-livecontainer",children:["Main executable (",(0,s.jsx)(i.code,{children:"LiveContainer"}),")"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Entry point for the entire platform. Handles bootstrapping, data management, container lifecycle, and launches LiveProcess instances for guests."}),"\n",(0,s.jsxs)(i.li,{children:["When no guest is running, it presents the SwiftUI interface (",(0,s.jsx)(i.code,{children:"LiveContainerSwiftUI"}),")."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"livecontainerswiftui",children:"LiveContainerSwiftUI"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["SwiftUI UI layer contributed by ",(0,s.jsx)(i.a,{href:"https://github.com/hugeBlack",children:"@hugeBlack"}),"."]}),"\n",(0,s.jsxs)(i.li,{children:["Hosts localization assets (",(0,s.jsx)(i.code,{children:"Localizable.xcstrings"}),"). Join our ",(0,s.jsx)(i.a,{href:"https://crowdin.com/project/livecontainer",children:"Crowdin project"})," to help translate strings."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"liveprocess",children:"LiveProcess"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Lightweight helper executable that contains the actual guest loader. It runs with the same entitlements but a different bundle identifier to make multitasking and PID-based JIT enabling possible."}),"\n",(0,s.jsx)(i.li,{children:"Responsible for patching the guest binary, configuring dyld, injecting tweaks, and transferring control to the app\u2019s entry point."}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"multitasksupport",children:"MultitaskSupport"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Implements the in-app floating window system plus native iPadOS window integration."}),"\n",(0,s.jsx)(i.li,{children:"Communicates with the primary container to keep app state and input routing synchronized across multiple LiveProcess instances."}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"sidestore-helpers",children:"SideStore helpers"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Code that integrates SideStore\u2019s refresh/JIT APIs. Provides background certificate refresh, source updates, and URL scheme handling for SideStore installations."}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"tweakloader",children:"TweakLoader"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Minimal substrate loader that ships inside LiveContainer."}),"\n",(0,s.jsxs)(i.li,{children:["Injected into every guest via a new load command; it can be overridden by replacing the ",(0,s.jsx)(i.code,{children:"TweakLoader.dylib"})," symlink."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"zsign",children:"ZSign"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Bundled signer (forked from ",(0,s.jsx)(i.a,{href:"https://github.com/zhlynn/zsign",children:"zhlynn/zsign"})," via ",(0,s.jsx)(i.a,{href:"https://github.com/khcrysalis/Feather",children:"Feather"}),")."]}),"\n",(0,s.jsx)(i.li,{children:"LiveContainer maintains a custom branch tailored to its entitlements and multi-container requirements."}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"third-party-libraries",children:"Third-party libraries"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"fishhook"}),", ",(0,s.jsx)(i.code,{children:"litehook"}),", and ",(0,s.jsx)(i.code,{children:"OpenSSL"})," live as git submodules. These power low-level hooking and crypto functionality used across the loader and signer."]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsx)(i.h3,{id:"preparing-the-guest-executable",children:"Preparing the guest executable"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Rewrite the ",(0,s.jsx)(i.code,{children:"__PAGEZERO"})," segment (",(0,s.jsx)(i.code,{children:"vmaddr = 0xFFFFC000"}),", ",(0,s.jsx)(i.code,{children:"vmsize = 0x4000"}),") so the binary can be mapped inside LiveProcess."]}),"\n",(0,s.jsxs)(i.li,{children:["Switch the Mach-O type from ",(0,s.jsx)(i.code,{children:"MH_EXECUTE"})," to ",(0,s.jsx)(i.code,{children:"MH_DYLIB"}),"."]}),"\n",(0,s.jsxs)(i.li,{children:["Inject a load command that loads ",(0,s.jsx)(i.code,{children:"TweakLoader.dylib"})," before ",(0,s.jsx)(i.code,{children:"UIApplicationMain"})," starts."]}),"\n"]}),"\n",(0,s.jsxs)(i.h3,{id:"patching-executable_path",children:["Patching ",(0,s.jsx)(i.code,{children:"@executable_path"})]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Modern builds hook ",(0,s.jsx)(i.code,{children:"dyld4::APIs::_NSGetExecutablePath"})," using litehook/fishhook."]}),"\n",(0,s.jsxs)(i.li,{children:["The hook calls the original implementation, makes the ",(0,s.jsx)(i.code,{children:"config.process.mainExecutablePath"})," writable, and swaps the path so the guest resolves its own bundle resources."]}),"\n",(0,s.jsxs)(i.li,{children:["Older SIGSEGV-based patching is no longer used but is documented in the ",(0,s.jsx)(i.a,{href:"https://github.com/LiveContainer/LiveContainer/blob/main/README.md",children:"main repo"})," for posterity."]}),"\n"]}),"\n",(0,s.jsxs)(i.h3,{id:"patching-nsbundlemainbundle",children:["Patching ",(0,s.jsx)(i.code,{children:"NSBundle.mainBundle"})]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"NSBundle.mainBundle"})," is overridden so APIs requesting bundle metadata receive the guest bundle instead of LiveContainer\u2019s."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"bypassing-library-validation--code-signing",children:"Bypassing Library Validation / Code Signing"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"When JIT is available, LiveContainer asks the configured enabler to lift the executable signature checks."}),"\n",(0,s.jsx)(i.li,{children:"In JIT-less mode, the bundled ZSign re-signs each guest plus tweaks using the certificate that was imported from AltStore/SideStore."}),"\n",(0,s.jsxs)(i.li,{children:["The bypass is based on ",(0,s.jsx)(i.a,{href:"https://blog.xpnsec.com/restoring-dyld-memory-loading",children:"Restoring Dyld Memory Loading"}),"."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"launching-the-app",children:"Launching the app"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["LiveProcess ",(0,s.jsx)(i.code,{children:"dlopen"}),"s the patched guest binary."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"TweakLoader"})," loads CydiaSubstrate and guest-specific tweak folders."]}),"\n",(0,s.jsxs)(i.li,{children:["The loader resolves the program entry point and jumps to it; the guest then calls ",(0,s.jsx)(i.code,{children:"UIApplicationMain"})," as usual."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"multi-account-support--keychain-semi-separation",children:"Multi-account support & keychain semi-separation"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"https://github.com/LiveContainer/LiveContainer/blob/main/entitlements.xml",children:"128 keychain access groups"})," are defined. Containers randomly pick groups to reduce cross-app keychain collisions, enabling isolated sign-ins per container."]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"limitations",children:"Limitations"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Guest entitlements aren\u2019t copied to the host. Only the base entitlements granted to LiveContainer apply."}),"\n",(0,s.jsx)(i.li,{children:"App permissions (camera, media library, etc.) are global to all guests."}),"\n",(0,s.jsx)(i.li,{children:"Containers share the same sandbox, so one malicious guest could read another guest\u2019s files."}),"\n",(0,s.jsx)(i.li,{children:"App extensions cannot be registered (SpringBoard is unaware of them and App IDs are limited)."}),"\n",(0,s.jsx)(i.li,{children:"Some multitasking scenarios still block hardware keyboards or iPhone Mirroring input."}),"\n",(0,s.jsx)(i.li,{children:"Remote push notifications and custom URL scheme queries often fail because LiveContainer cannot register them with SpringBoard."}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,i,n){n.d(i,{R:()=>a,x:()=>l});var t=n(6540);const s={},r=t.createContext(s);function a(e){const i=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:i},e.children)}}}]);